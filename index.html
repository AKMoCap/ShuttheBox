<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Shut the Box</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="header-container">
    <h1>SHUT THE BOX</h1>
    <div class="play-mode-buttons">
      <button id="freePlayBtn" class="mode-btn active">Free Play</button>
      <button id="perpPlayBtn" class="mode-btn">PerpPlay - Connect Wallet</button>
      <button id="disconnectBtn" class="mode-btn disconnect-btn" style="display: none;">Disconnect</button>
    </div>
    <div id="walletAddress" class="wallet-address" style="display: none;"></div>
  </div>

  <!-- GAME + SIDEBAR FLEX -->
  <div class="game-container">
    <!-- BOARD WRAP: canvas + dice result + roll button -->
    <div id="boardWrap">
      <canvas id="board" width="900" height="660"></canvas>
      <div id="diceResult"></div>
      <button id="rollBtn" class="primary">ROLL</button>
    </div>

    <!-- RIGHT COLUMN: odds, collateral selector, then stats -->
    <div class="right-container">
      <div id="immediateOddsDisplay">
        <div class="odds-label">Odds to Survive:</div>
        <div class="odds-value"><span id="immediateOdds">‚Ä¶</span></div>
      </div>

      <!-- Collateral selector - only shown in PerpPlay mode -->
      <div id="collateralSection" class="collateral-section" style="display: none;">
        <div class="collateral-label">Perp Collateral:</div>
        <div class="collateral-buttons">
          <button class="collateral-btn active" data-amount="10">$10</button>
          <button class="collateral-btn" data-amount="100">$100</button>
          <button class="collateral-btn" data-amount="500">$500</button>
          <button class="collateral-btn" data-amount="1000">$1,000</button>
        </div>
      </div>

      <div id="statsSection">
        <table>
          <tr>
            <td>Total Players</td>
            <td><span id="playerCount">‚Ä¶</span></td>
          </tr>
          <tr>
            <td>Total Plays</td>
            <td><span id="playCount">‚Ä¶</span></td>
          </tr>
          <tr>
            <td>Total Wins</td>
            <td><span id="winCount">‚Ä¶</span></td>
          </tr>
          <tr>
            <td>Total Losses</td>
            <td><span id="loseCount">‚Ä¶</span></td>
          </tr>
          <tr>
            <td>Your Wins</td>
            <td><span id="yourWins">0</span></td>
          </tr>
          <tr>
            <td>Your Losses</td>
            <td><span id="yourLosses">0</span></td>
          </tr>
        </table>

        <!-- Desktop-only controls cheat-sheet -->
        <div id="controlsBox" class="controls-box">
          <strong>Keyboard Controls</strong><br>
          Enter ‚Äì Roll<br>
          Arrows ‚Äì Select Cards<br>
          Spacebar ‚Äì Flip/Unflip<br>
          Ctrl + R ‚Äì Restart
        </div>
      </div>
    </div>
  </div>

  <!-- bottom controls -->
  <div id="scoreBar">Remaining total: <span id="remaining">78</span></div>
  <div id="controls">
    <label><input type="radio" name="diceMode" value="1"> 1 Die</label>
    <label><input type="radio" name="diceMode" value="2" checked> 2 Dice</label>
  </div>
  <button id="restartBtn">Restart Game</button>
  <button id="soundToggle">üîá Sound</button>

  <!-- New instructions box -->
  <div id="instructions">
    <strong>Instructions:</strong>
    <p>
      The goal of the game is to "shut the box" by rolling dice to turn over every card.
      For example, if you roll a 7, it is your choice to turn over the 7 card, or any combination of cards that adds to
      7.
      If you are down to single digit cards, you have the choice to roll just 1 die.
    </p>
    <p>Good luck!</p>
  </div>

  <!-- Trade popup for PerpPlay mode -->
  <div id="tradePopup" class="trade-popup" style="display: none;">
    <div class="trade-popup-content">
      <button id="closeTradePopup" class="close-trade-btn" style="display: none;">‚úï</button>
      <div class="trade-header">
        <span id="tradeIcon">üöÄ</span>
        <span id="tradeTitle">Opening Position...</span>
      </div>
      <div class="trade-details">
        <div class="trade-row">
          <span class="trade-label">Token:</span>
          <span id="tradeToken" class="trade-value">-</span>
        </div>
        <div class="trade-row">
          <span class="trade-label">Side:</span>
          <span id="tradeSide" class="trade-value long">LONG</span>
        </div>
        <div class="trade-row">
          <span class="trade-label">Leverage:</span>
          <span id="tradeLeverage" class="trade-value">20x</span>
        </div>
        <div class="trade-row">
          <span class="trade-label">Collateral:</span>
          <span id="tradeCollateral" class="trade-value">-</span>
        </div>
        <div class="trade-row">
          <span class="trade-label">Size:</span>
          <span id="tradeSize" class="trade-value">-</span>
        </div>
        <div class="trade-row">
          <span class="trade-label">Entry Price:</span>
          <span id="tradeEntry" class="trade-value">-</span>
        </div>
        <div class="trade-countdown">
          <span>Closing in: </span>
          <span id="tradeCountdown" class="countdown-value">15</span>
          <span>s</span>
        </div>
      </div>
      <div class="trade-result" id="tradeResult" style="display: none;">
        <div class="trade-pnl">
          <span class="trade-label">PnL:</span>
          <span id="tradePnl" class="trade-value">-</span>
        </div>
        <div class="trade-close-hint">Press SPACE or click ‚úï to close</div>
      </div>
    </div>
  </div>

  <!-- Wallet connection modal -->
  <div id="walletModal" class="wallet-modal" style="display: none;">
    <div class="wallet-modal-content">
      <h2>Connect Wallet</h2>
      <p>Connect your wallet to play PerpPlay mode on Hyperliquid</p>
      <div class="wallet-options">
        <button id="connectMetamask" class="wallet-option">
          <span class="wallet-icon">ü¶ä</span>
          <span>MetaMask</span>
        </button>
        <button id="connectRabby" class="wallet-option">
          <span class="wallet-icon">üê∞</span>
          <span>Rabby</span>
        </button>
      </div>
      <button id="closeWalletModal" class="close-modal">Cancel</button>
    </div>
  </div>

  <!-- firebase & game scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/hyperliquid@1.2.2/dist/browser.global.js"></script>
  <script src="firebase.js"></script>
  <script src="hyperliquid.js"></script>
  <script src="stb.js"></script>
</body>

</html>
